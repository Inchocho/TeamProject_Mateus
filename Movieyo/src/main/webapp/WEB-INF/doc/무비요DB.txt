--- 여기에 테이블이랑 예제 데이터, 셀렉문이 있습니다

-- 2022/11/23 DB 테이블 및 시퀀스 조회
-- SELECT * FROM ALL_TABLES WHERE TABLE_NAME LIKE '%MVY%' or  TABLE_NAME LIKE '%GENRE%';
-- SELECT * FROM ALL_SEQUENCES WHERE SEQUENCE_NAME LIKE '%MVY%'  or  SEQUENCE_NAME LIKE '%GENRE%';

-- SELECT 'DROP TABLE '||TABLE_NAME||';'from user_tables WHERE TABLE_NAME LIKE '%MVY%';
-- SELECT 'DROP TABLE '||TABLE_NAME||';'from user_tables WHERE TABLE_NAME LIKE '%GENRE%';

-- 2022/11/23 DB 변경시 테이블 삭제 명령어

-- DROP TABLE MVY_MOVIE;
-- DROP TABLE MVY_MOVIE_PHOTO;
-- DROP TABLE MVY_CART;
-- DROP TABLE MVY_BUY;
-- DROP TABLE MVY_REFUND;
-- DROP TABLE MVY_USER;
-- DROP TABLE MVY_BOARD;
-- DROP TABLE MVY_USER_CHARGE;
-- DROP TABLE GENRE;
-- DROP TABLE GENRE_MOVIE;
-- DROP TABLE GENRE_USER;

-- 시퀀스 삭제 명령어
--drop SEQUENCE MVY_BOARD_NO_SEQ;
--drop SEQUENCE MVY_BUY_NO_SEQ;
--drop SEQUENCE MVY_CART_NO_SEQ;
--drop SEQUENCE MVY_MOVIE_NO_SEQ;
--drop SEQUENCE MVY_MOVIE_PHOTO_SEQ;
--drop SEQUENCE MVY_REFUND_NO_SEQ;
--drop SEQUENCE MVY_USER_CHARGE_NO_SEQ;
--drop SEQUENCE MVY_USER_NO_SEQ;
--drop SEQUENCE GENRE_NO_SEQ;
--drop SEQUENCE GENRE_MOVIE_NO_SEQ;
--drop SEQUENCE GENRE_USER_NO_SEQ;


-- 무비요 ER 테이블 
-- 영화
-- 2022년11월23일 변경( -- 등록일, 수정일 추가 CREDATE,MODDATE)
-- 11월 29일 변경(MODDATE삭제/ 영화점수rate,영화내용story 추가)
CREATE TABLE MVY_MOVIE(
	MOVIE_NO       NUMBER PRIMARY KEY,	
	GENRE_NO	   NUMBER NOT NULL,
	GENRE_NAME 	   VARCHAR2(40) NOT NULL, 		      
	MOVIE_TITLE    VARCHAR2(40) NOT NULL,
	MOVIE_PRDTYEAR DATE NOT NULL,
	MOVIE_NATION   VARCHAR2(40) NOT NULL, 
	MOVIE_DIRECTOR VARCHAR2(40) NOT NULL,
	MOVIE_RUNTIME  NUMBER	NOT NULL, 
	MOVIE_GRADE    VARCHAR2(40) NOT NULL,
	MOVIE_PRICE    NUMBER NOT NULL,      
	MOVIE_REGISTRANT   VARCHAR2(40) NOT NULL,
	MOVIE_CREDATE  DATE NOT NULL,	
	MOVIE_RATE     NUMBER DEFAULT 0,
    MOVIE_STORY    VARCHAR2(4000)
);


-- 영화 사진(2022.11.22 기존 파일업로드형식으로 사용하려고 칼럼명을 맞춤)
CREATE TABLE MVY_MOVIE_PHOTO(
    IDX                NUMBER PRIMARY KEY,
    PARENT_SEQ         NUMBER NOT NULL,
    ORIGINAL_FILE_NAME VARCHAR2(260) NOT NULL,
    STORED_FILE_NAME   VARCHAR2(36) NOT NULL,  
    FILE_SIZE          NUMBER,        
    CRE_DATE           DATE NOT NULL
);

-- 장바구니
-- 11.29(담은날짜INCARTDATE 추가)
CREATE TABLE MVY_CART(
    CART_NO NUMBER PRIMARY KEY, -- 기본키
    USER_NO NUMBER NOT NULL,             -- 유저번호 외래키1 (유저) MVY_USER테이블의 USER_NO
    MOVIE_NO NUMBER NOT NULL,             -- 영화번호 외래키2 (상품) MVY_MOVIE테이블의 MOVIE_NO
    CART_INCARTDATE DATE DEFAULT SYSDATE
);

-- 구매내역
-- 구매테이블 변경
--구매신청일 -> 등록시 DEFAULT SYSDATE로 등록됨
--구매상태 -> 등록시 DEFAULT '보유중'으로 등록됨
--유저번호, 영화번호(상품)를 외래키로 사용

CREATE TABLE MVY_BUY(
	BUY_NO NUMBER PRIMARY KEY,
	MOVIE_NO NUMBER NOT NULL,
	USER_NO NUMBER NOT NULL,
	BUY_DATE DATE DEFAULT SYSDATE,
	BUY_STATUS DEFAULT '보유중'
);


-- 환불내역
-- 환불테이블 변경
CREATE TABLE MVY_REFUND(
    REFUND_NO NUMBER PRIMARY KEY,
    USER_NO NUMBER NOT NULL,
    BUY_NO NUMBER NOT NULL,
    REFUND_DATE DATE DEFAULT SYSDATE,
    REFUND_STATUS  VARCHAR2(40) DEFAULT '신청중'
);


	
-- 유저(11/24 - 유저캐쉬, 관리자확인 칼럼 추가)
CREATE TABLE MVY_USER(
    USER_NO NUMBER PRIMARY KEY,     -- 기본키
    USER_EMAIL VARCHAR2(40) NOT NULL,        -- 이메일
    USER_PASSWORD VARCHAR2(40) NOT NULL,     -- 비밀번호
    USER_NAME VARCHAR2(40) NOT NULL,         -- 이름
    USER_BIRTH DATE NOT NULL,                -- 생일
    USER_CREDATE DATE NOT NULL,				 -- 유저 생성일
    USER_NICKNAME VARCHAR2(40) NOT NULL,     -- 닉네임
    USER_GENDER VARCHAR2(10) NOT NULL,        -- 성별
    --USER_GENRE VARCHAR2(40)
    USER_CASH	NUMBER	DEFAULT 0,			 -- 유저캐쉬(11/24 -- 충전내역테이블에서 가져옴)
    USER_ADMIN  NUMBER  DEFAULT 0            -- 관리자확인(11/24 -- DEFAULT 0 (유저) 관리자 1)
);	

-- 장르테이블
CREATE TABLE GENRE(
    GENRE_NO NUMBER PRIMARY KEY,    -- 기본키
    GENRE_NAME VARCHAR2(40) NOT NULL         -- 장르명
);

-- 장르테이블-영화
CREATE TABLE GENRE_MOVIE(
    GENRE_MOVIE_NO NUMBER PRIMARY KEY,  -- 장르영화 번호 기본키
    MOVIE_NO NUMBER NOT NULL,                    -- 영화번호 외래키	MVY_MOVIE테이블의 MOVIE_NO
    GENRE_NO NUMBER NOT NULL                     -- 장르번호 외래키	GENRE 테이블의 GENRE_NO
);

-- 장르테이블-유저
CREATE TABLE GENRE_USER(
    GENRE_USER_NO NUMBER PRIMARY KEY,   -- 장르유저 번호 기본키
    USER_NO NUMBER NOT NULL,                     -- 유저번호 외래키	MVY_USER 테이블의 USER_NO
    GENRE_NO NUMBER NOT NULL                     -- 장르번호 외래키	GENRE 테이블의 GENRE_NO
);

-- 게시판
CREATE TABLE MVY_BOARD(
    BOARD_NO NUMBER PRIMARY KEY,    -- 기본키
    USER_NO NUMBER NOT NULL,                 -- 외래키	MVY_USER 테이블의 USER_NO
    BOARD_HEAD VARCHAR2(40) NOT NULL,        -- 말머리
    BOARD_TITLE VARCHAR2(40) NOT NULL,       -- 제목
    BOARD_CONTENT VARCHAR2(4000) NOT NULL,   -- 내용
    BOARD_CREDATE DATE NOT NULL,             -- 작성일
    BOARD_MODDATE DATE NOT NULL,             -- 수정일
    BOARD_COUNT NUMBER DEFAULT 0             -- 조회수(디폴트 0)
);

-- 유저 캐쉬충전(11/24 -- 일단 보류)
CREATE TABLE MVY_USER_CHARGE(
    CHARGE_NO NUMBER PRIMARY KEY,   -- 기본키
    USER_NO NUMBER NOT NULL,                 -- 외래키 유저	MVY_USER 테이블의 USER_NO
    CHARGE_DATE DATE NOT NULL,               -- 충전일
    CHARGE_CASH NUMBER NOT NULL              -- 충전한 캐쉬내역
);

-- 테이블 제약조건(외래키) 추가
-- 장르테이블 외래키(장르번호) 연결 제약조건
ALTER TABLE MVY_MOVIE ADD CONSTRAINT
MVY_MOVIE_GENRE_NO_FK FOREIGN KEY(GENRE_NO) REFERENCES GENRE(GENRE_NO);

-- 영화사진 테이블의 영화번호 외래키 조건 추가
ALTER TABLE MVY_MOVIE_PHOTO ADD CONSTRAINT MVY_MOVIE_PHOTO_MOVIE_NO_FK FOREIGN KEY(MOVIE_NO) REFERENCES MVY_MOVIE(MOVIE_NO); 

-- 장바구니 테이블의 유저번호, 영화번호 외래키 조건 추가
ALTER TABLE MVY_CART ADD CONSTRAINT MVY_CART_USER_NO_FK FOREIGN KEY(USER_NO) REFERENCES MVY_USER(USER_NO); 
ALTER TABLE MVY_CART ADD CONSTRAINT MVY_CART_MOVIE_NO_FK FOREIGN KEY(MOVIE_NO) REFERENCES MVY_MOVIE(MOVIE_NO); 

-- 구매테이블 외래키 조건 추가
ALTER TABLE MVY_BUY ADD CONSTRAINT MVY_BUY_USER_NO_FK FOREIGN KEY(USER_NO) REFERENCES MVY_USER(USER_NO); 
ALTER TABLE MVY_BUY ADD CONSTRAINT MVY_BUY_MOVIE_NO_FK FOREIGN KEY(MOVIE_NO) REFERENCES MVY_MOVIE(MOVIE_NO); 

-- 장바구니 테이블의 유저번호, 영화번호 외래키 조건 추가
ALTER TABLE MVY_REFUND ADD CONSTRAINT MVY_REFUND_BUY_NO_FK FOREIGN KEY(BUY_NO) REFERENCES MVY_BUY(BUY_NO); 

-- 장르무비 테이블의 영화번호, 장르번호 외래키 조건 추가
ALTER TABLE GENRE_MOVIE ADD CONSTRAINT GENRE_MOVIE_MOVIE_NO_FK FOREIGN KEY(MOVIE_NO) REFERENCES MVY_MOVIE(MOVIE_NO); 
ALTER TABLE GENRE_MOVIE ADD CONSTRAINT GENRE_MOVIE_GENRE_NO_FK FOREIGN KEY(GENRE_NO) REFERENCES GENRE(GENRE_NO); 

-- 장르유저 테이블의 유저번호, 장르번호 외래키 조건 추가
ALTER TABLE GENRE_USER ADD CONSTRAINT GENRE_USER_USER_NO_FK FOREIGN KEY(USER_NO) REFERENCES MVY_USER(USER_NO); 
ALTER TABLE GENRE_USER ADD CONSTRAINT GENRE_USER_GENRE_NO_FK FOREIGN KEY(GENRE_NO) REFERENCES GENRE(GENRE_NO); 

-- 게시판 테이블의 유저번호 외래키 조건 추가
ALTER TABLE MVY_BOARD ADD CONSTRAINT MVY_BOARD_USER_NO_FK FOREIGN KEY(USER_NO) REFERENCES MVY_USER(USER_NO); 

-- 유저캐쉬충전 테이블의 유저번호 외래키 조건 추가
ALTER TABLE MVY_USER_CHARGE ADD CONSTRAINT MVY_USER_CHARGE_USER_NO_FK FOREIGN KEY(USER_NO) REFERENCES MVY_USER(USER_NO); 

-- 환불테이블 외래키 조건 추가
ALTER TABLE MVY_REFUND ADD CONSTRAINT
MVY_REFUND_USER_NO_FK FOREIGN KEY(USER_NO) REFERENCES MVY_USER(USER_NO);
--시퀀스----

-- 영화테이블 시퀀스
CREATE SEQUENCE MVY_MOVIE_NO_SEQ    -- 영화번호(기본키) 시퀀스
    START WITH 1
    INCREMENT BY 1;

-- 영화사진테이블 시퀀스
CREATE SEQUENCE MVY_MOVIE_PHOTO_SEQ -- 영화사진번호(기본키) 시퀀스
    START WITH 1
    INCREMENT BY 1;
    
-- 장바구니테이블 시퀀스
CREATE SEQUENCE MVY_CART_NO_SEQ -- 카트번호(기본키) 시퀀스
    START WITH 1
    INCREMENT BY 1;
    
-- 구매내역테이블 시퀀스
CREATE SEQUENCE MVY_BUY_NO_SEQ  -- 구매내역번호(기본키) 시퀀스
    START WITH 1
    INCREMENT BY 1;

-- 환불내역테이블 시퀀스
CREATE SEQUENCE MVY_REFUND_NO_SEQ -- 환불내역번호(기본키) 시퀀스
    START WITH 1
    INCREMENT BY 1;

-- 유저테이블 시퀀스
CREATE SEQUENCE MVY_USER_NO_SEQ -- 유저번호(기본키) 시퀀스
    START WITH 1
    INCREMENT BY 1;
    
-- 장르테이블 시퀀스
CREATE SEQUENCE GENRE_NO_SEQ -- 장르번호(기본키) 시퀀스 --> 근데 이건 고정값으로 먼저 입력하고 쓸 예정
    START WITH 1
    INCREMENT BY 1;

-- 장르영화 테이블 시퀀스    
CREATE SEQUENCE GENRE_MOVIE_NO_SEQ -- 장르영화번호 (기본키) 시퀀스
    START WITH 1
    INCREMENT BY 1;
    
-- 장르유저 테이블 시퀀스
CREATE SEQUENCE GENRE_USER_NO_SEQ -- 장르유저번호 (기본키) 시퀀스
    START WITH 1
    INCREMENT BY 1;

-- 게시판 테이블 시퀀스
CREATE SEQUENCE MVY_BOARD_NO_SEQ -- 게시판번호 (기본키) 시퀀스
    START WITH 1
    INCREMENT BY 1;

-- 유저충전테이블 시퀀스
CREATE SEQUENCE MVY_USER_CHARGE_NO_SEQ -- 유저충전번호(기본키) 시퀀스
    START WITH 1
    INCREMENT BY 1;

----------- 데이터 추가 예제
-- GENRE 테이블에 사용할 데이터값(2022-11-24)
INSERT INTO GENRE VALUES(1, '애니메이션');
INSERT INTO GENRE VALUES(2, '드라마');
INSERT INTO GENRE VALUES(3, '코미디');
INSERT INTO GENRE VALUES(4, '다큐멘터리');
INSERT INTO GENRE VALUES(5, '범죄');
INSERT INTO GENRE VALUES(6, '성인물(에로)');
INSERT INTO GENRE VALUES(7, 'SF');
INSERT INTO GENRE VALUES(8, '멜로/로맨스');
INSERT INTO GENRE VALUES(9, '어드벤처');
INSERT INTO GENRE VALUES(10, '공포(호러)');
INSERT INTO GENRE VALUES(11, '스릴러');
INSERT INTO GENRE VALUES(12, '기타');










