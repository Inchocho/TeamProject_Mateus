-- 구매테이블 변경
구매신청일 -> 등록시 DEFAULT SYSDATE로 등록됨
구매상태 -> 등록시 DEFAULT '보유중'으로 등록됨
유저번호, 영화번호(상품)를 외래키로 사용

CREATE TABLE MVY_BUY(
	BUY_NO NUMBER PRIMARY KEY,
	MOVIE_NO NUMBER NOT NULL,
	USER_NO NUMBER NOT NULL,
	BUY_DATE DATE DEFAULT SYSDATE,
	BUY_STATUS DEFAULT '보유중'
);

ALTER TABLE MVY_BUY ADD CONSTRAINT
MVY_BUY_MOVIE_NO_FK FOREIGN KEY(MOVIE_NO) REFERENCES MVY_MOVIE(MOVIE_NO);
ALTER TABLE MVY_BUY ADD CONSTRAINT
MVY_BUY_USER_NO_FK FOREIGN KEY(USER_NO) REFERENCES MVY_USER(USER_NO);

-- 환불테이블 변경
환불신청일 -> 등록시 SYSDATE로 등록됨 
환불상태 -> 디폴트값 '미신청'으로 등록됨
유저번호 외래키로 사용

CREATE TABLE MVY_REFUND(
    REFUND_NO NUMBER PRIMARY KEY,
    USER_NO NUMBER NOT NULL,
    BUY_NO NUMBER NOT NULL,
    REFUND_DATE DATE DEFAULT SYSDATE,
    REFUND_STATUS  VARCHAR2(40) DEFAULT '신청중'
);

ALTER TABLE MVY_REFUND ADD CONSTRAINT
MVY_REFUND_USER_NO_FK FOREIGN KEY(USER_NO) REFERENCES MVY_USER(USER_NO);

-- 영화테이블 변경
-- 영화번호/장르번호/장르명/영화제목/영화국가/영화감독/영화상영시간/영화등급/영화가격/영화등록자/영화등록일/영화점수
CREATE TABLE MVY_MOVIE(
	MOVIE_NO       NUMBER PRIMARY KEY,	
	GENRE_NO	   NUMBER NOT NULL,
	GENRE_NAME 	   VARCHAR2(40) NOT NULL, 		      
	MOVIE_TITLE    VARCHAR2(40) NOT NULL,
	MOVIE_PRDTYEAR DATE NOT NULL,
	MOVIE_NATION   VARCHAR2(40) NOT NULL, 
	MOVIE_DIRECTOR VARCHAR2(40) NOT NULL,
	MOVIE_RUNTIME  NUMBER	NOT NULL, 
	MOVIE_GRADE    VARCHAR2(40) NOT NULL,
	MOVIE_PRICE    NUMBER NOT NULL,      
	MOVIE_REGISTRANT   VARCHAR2(40) NOT NULL,
	MOVIE_CREDATE  DATE NOT NULL,	
	MOVIE_RATE     NUMBER DEFAULT 0     
);

-- 영화테이블 - 장르테이블 외래키(장르번호) 연결 제약조건
ALTER TABLE MVY_MOVIE ADD CONSTRAINT
MVY_MOVIE_GENRE_NO_FK FOREIGN KEY(GENRE_NO) REFERENCES GENRE(GENRE_NO);
