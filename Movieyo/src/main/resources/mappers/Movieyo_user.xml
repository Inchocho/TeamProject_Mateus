<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.movieyo.user">

	<resultMap type="userDto" id="userResultMap">
		<id column="USER_NO" property="userNo"/>
		<result column="USER_EMAIL" property="email"/>
		<result column="USER_PASSWORD" property="password"/>
		<result column="USER_NAME" property="userName"/>
		<result column="USER_BIRTH" property="userBirth"
			javaType="java.util.Date"/>
		<result column="USER_CREDATE" property="userCreateDate"
			javaType="java.util.Date"/>
		<result column="USER_NICKNAME" property="nickname"/>
		<result column="USER_GENDER" property="gender"/>
	</resultMap>

	<select id="userExist" parameterType="map" 
		resultMap="userResultMap">
		SELECT USER_NO, USER_NAME, USER_CREDATE, USER_BIRTH, USER_NICKNAME, USER_GENDER
		FROM MVY_USER
		WHERE USER_EMAIL = #{email} AND USER_PASSWORD = #{password}		
	</select>
	
	<insert id="userInsertOne" parameterType="com.movieyo.user.dto.UserDto"
		useGeneratedKeys="true" keyProperty="userNo">
		
		<selectKey keyProperty="userNo" resultType="int" order="BEFORE">
			select MVY_USER_NO_SEQ.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO MVY_USER
		VALUE(USER_NO, USER_EMAIL, USER_PASSWORD, USER_NAME, USER_BIRTH
		, USER_CREDATE, USER_NICKNAME, USER_GENDER)
		VALUES(#{userNo}, #{email}, #{password}, #{userName}
		, #{userBirth}, SYSDATE, #{nickname}, #{gender})
	</insert>
	
	<select id="userSelectOne" parameterType="int"
		resultMap="userResultMap">
		SELECT USER_NO, USER_NAME, USER_CREDATE, USER_BIRTH, USER_NICKNAME, USER_GENDER
		FROM MVY_USER
		WHERE USER_NO = #{userNo}		
	</select>
	
	<update id="userUpdateOne" parameterType="userDto">
		UPDATE MVY_USER
		SET USER_NICKNAME = #{nickname}
		WHERE USER_NO = #{userNo}		
	</update>
	
	<update id="passwordUpdate" parameterType="userDto">
		UPDATE MVY_USER
		SET USER_PASSWORD = #{password}
		WHERE USER_NO = #{userNo}
	</update>
	
	<delete id="userDeleteOne" parameterType="int">
		DELETE FROM MVY_USER
		WHERE USER_NO = #{userNo}
	</delete>

	<update id="updatePw" parameterType="userDto">
		UPDATE MVY_USER SET USER_PASSWORD = #{password} WHERE USER_EMAIL = #{email}		
	</update>

	<select id="readMember" parameterType="string"
		resultMap="userResultMap">
		SELECT USER_NO, USER_NAME, USER_EMAIL, USER_CREDATE
		FROM MVY_USER
		WHERE USER_EMAIL = #{email}		
	</select>


</mapper>