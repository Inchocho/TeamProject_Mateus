<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.movieyo.board">


	<resultMap type="boardDto" id="boardResultMap">
		<id column="BOARD_NO" property="boardNo"/>
		<result column="USER_NO" property="userNo"/>
		<result column="BOARD_HEAD" property="boardHead"/>
		<result column="BOARD_TITLE" property="boardTitle"/>
		<result column="BOARD_CONTENT" property="boardContent"/>
		<result column="BOARD_CREDATE" property="boardCredate"/>
		<result column="BOARD_MODDATE" property="boardModdate"/>
		<result column="BOARD_COUNT" property="boardCount"/>
	</resultMap>
	
	<sql id="search">
		<choose>
			<when test="searchOption == 'all'">
				WHERE BOARD_NO LIKE '%'||#{keyword}||'%'
				OR BOARD_TITLE LIKE '%'||#{keyword}||'%'
			</when>
			<otherwise>
				WHERE ${searchOption} LIKE '%'||#{keyword}||'%'
			</otherwise>
		</choose>
	</sql>



	<delete id="boardDeleteOne" parameterType="int">
		DELETE FROM MVY_BOARD
		WHERE BOARD_NO = #{BOARD_NO}
	</delete>
<!-- 	게시글 추가 -->
    <insert id="boardInsertOne" parameterType="boardDto" useGeneratedKeys="true" keyProperty="boardNo">
    
    <selectKey keyProperty="boardNo" resultType="int" order="BEFORE">
			select MVY_BOARD_NO_SEQ.NEXTVAL FROM DUAL
	</selectKey>
        INSERT INTO MVY_BOARD
        VALUE(BOARD_NO, USER_NO, BOARD_HEAD, BOARD_TITLE, BOARD_CONTENT, BOARD_CREDATE, BOARD_MODDATE)
        VALUES 
            (#{boardNo}, #{userNo}, #{boardHead}, #{boardTitle}, #{boardContent}, SYSDATE, SYSDATE)
    </insert>
<!--  게시글 리스트 -->
    <select id="boardSelectList" parameterType="map" resultMap="boardResultMap">
		SELECT BOARD_NO, USER_NO, BOARD_HEAD, BOARD_TITLE, BOARD_CONTENT, BOARD_CREDATE, BOARD_MODDATE, BOARD_COUNT
		   FROM (
		        SELECT ROWNUM RNUM, BOARD_NO, USER_NO, BOARD_HEAD, BOARD_TITLE
				, BOARD_CONTENT, BOARD_CREDATE, BOARD_MODDATE, BOARD_COUNT
		        FROM (
	                SELECT ROWNUM RNUM, BOARD_NO, USER_NO, BOARD_HEAD, BOARD_TITLE
				, BOARD_CONTENT, BOARD_CREDATE, BOARD_MODDATE, BOARD_COUNT
	         	   	   FROM MVY_BOARD	
	         	   	   <include refid="search"></include>
			           ORDER BY BOARD_NO ASC) B
      				) BD
		WHERE BD.RNUM BETWEEN #{start} AND #{end}
	</select>
	
   <!-- 	게시글 총갯수 -->
	<select id="boardSelectTotalCount" resultType="java.lang.Integer" parameterType="map">
		SELECT COUNT(*)
		FROM MVY_BOARD
		<include refid="search"></include>
	</select>
	
	
	<update id="boardViewCount" parameterType="int">
        UPDATE MVY_BOARD
        SET   BOARD_COUNT = BOARD_COUNT + 1
        WHERE BOARD_NO = #{boardNo}
    </update>
</mapper>